# 追加要件メモ: 製造工程品目部品表との連携

## 追加データソース
- ファイル: `20251006_163401_製造工程-部品表.txt`
- 形式: UTF-8 / TSV（タブ区切り）
- 主なカラム（先頭は記号付き。実体は以下のとおり）
  - `★製造工程品目コード` (親品目コード)
    - データ上は同じ親コードが複数行連続して出現する。BOM は上から順に評価し、
      子部品 ( `★製造工程品目コード.1` ) を複数持つケースを前提とする。
  - `製造品目テキスト`
  - `...`（工程関連フラグ多数）
  - `★製造工程品目コード.1` (部品側コード / 子品目)
  - `製造品目テキスト.1` (子品目名)
  - `基本数量` など数量関連（入力データの数量 × 基本数量 = ピッキング対象数量）
- 1 親品目に対し、複数行の部品構成（1 階層）を持つ。

## 連携方針
1. 既存の「入力データ」（出荷計画シート）と TXT `★製造工程品目コード` を品目コードで突合せ。
2. 一致した場合、TXT の子品目 (`★製造工程品目コード.1`) を 1 階層下の BOM としてピッキング対象に追加。
3. 子品目についてもマスタ参照（同じ既存マッピング）を行い、
   - 品目名 / ロケーション / 数量など必要項目を取得。
   - 数量は `構成品目数量` 等、TXT 側の値を使用予定。
4. 出力順序と No 付番ルール
   - 親品目は従来通り 1〜6… の連番。
   - 子品目は「親の No を接頭にしたハイフン表記」で出力（例: 親 6 → 子 6-1, 6-2）。
   - 子品目も同じ枠レイアウト（6 枚構成内）で扱う。
5. QR コード生成について
   - 親品目・子品目ともに品目コードを QR 化。
   - 子品目の QR も同様に右端に表示。

## 実装タスク案
- [x] BOM TSV のローダーを追加し、UTF-8/タブ区切りで DataFrame 化（ヘッダの記号処理を含む）。
- [x] 親コード → 子部品一覧を辞書化し、パイプラインのマージ処理に組み込み。
- [x] 子品目行の `PickingRow` を生成できるよう、`join_and_map` 以降の処理フローを拡張。
- [x] No 付番ロジックのリファクタ（親・子の 2 段階表記対応）。
- [x] テンプレートの 1 枠設計を再確認し、子品目でも視認性が保てるよう調整。
- [ ] サンプルデータ整備: BOM 連携を含むダミー Excel/TXT を `docs` or `data/` に整理。
- [x] テストケース追加（親＋子品目混在、子品目が多いケース、BOM 無しケースなど）。

## EXE 化に向けたメモ
- PyInstaller CLI 例: `pyinstaller --noconsole --name PickingSystem src/ui_desktop/main.py`
- 実行時に Playwright, wkhtmltopdf, QR データ出力ディレクトリ等が扱えるよう、
  - `output/` と `data/` の構成を再整理する（例: `data/shipment/`, `data/master/`, `data/bom/`）。
  - 設定ファイル (`spec.yml`) に BOM 有無・TXT パスの項目を追加予定。

